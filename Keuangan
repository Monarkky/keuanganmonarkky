import csv
import os
from datetime import datetime

# Nama file tempat data akan disimpan otomatis
FILE_NAME = 'history_keuangan.csv'

def inisialisasi_file():
    """Membuat file dan header tabel jika belum ada."""
    if not os.path.exists(FILE_NAME):
        with open(FILE_NAME, mode='w', newline='') as file:
            writer = csv.writer(file)
            writer.writerow(['Tanggal', 'Nama', 'Keterangan', 'Bank', 'Nominal', 'Total'])

def get_saldo_sebelumnya():
    """Mengambil total saldo dari baris terakhir di history."""
    if not os.path.exists(FILE_NAME):
        return 0.0
    
    with open(FILE_NAME, mode='r') as file:
        reader = list(csv.reader(file))
        if len(reader) > 1: # Memastikan ada data selain header
            baris_terakhir = reader[-1]
            return float(baris_terakhir[5]) # Index 5 adalah kolom 'Total'
    return 0.0

def input_data():
    """Fungsi untuk memasukkan data baru."""
    print("\n--- MASUKKAN DATA BARU ---")
    
    # Tanggal otomatis hari ini jika dikosongkan
    tanggal = input("Tanggal (DD-MM-YYYY) [Tekan Enter untuk hari ini]: ")
    if not tanggal:
        tanggal = datetime.now().strftime("%d-%m-%Y")
        
    nama = input("Nama: ")
    keterangan = input("Keterangan: ")
    bank = input("Bank: ")
    
    try:
        # Gunakan angka minus (-) untuk pengeluaran, angka biasa untuk pemasukan
        nominal = float(input("Nominal (Contoh: 50000 untuk masuk, -20000 untuk keluar): "))
    except ValueError:
        print("❌ Error: Nominal harus berupa angka!")
        return

    # Logika Total = Nominal + Saldo Sebelumnya
    saldo_sebelumnya = get_saldo_sebelumnya()
    total = saldo_sebelumnya + nominal

    # Menyimpan data secara otomatis (Append)
    with open(FILE_NAME, mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([tanggal, nama, keterangan, bank, nominal, total])
    
    print(f"✅ Data berhasil disimpan! Total saldo saat ini: Rp {total:,.2f}")

def cek_history():
    """Fungsi untuk melihat tabel history data."""
    print("\n--- HISTORY PENCATATAN ---")
    if not os.path.exists(FILE_NAME):
        print("Belum ada data yang tersimpan.")
        return
        
    with open(FILE_NAME, mode='r') as file:
        reader = csv.reader(file)
        print("-" * 90)
        for row in reader:
            # Format tabel agar rapi saat dicetak di layar
            print(f"{row[0]:<12} | {row[1]:<15} | {row[2]:<20} | {row[3]:<10} | {row[4]:<12} | {row[5]}")
        print("-" * 90)

def main():
    inisialisasi_file()
    while True:
        print("\n=== PROGRAM PENCATATAN KEUANGAN ===")
        print("1. Input Data Baru")
        print("2. Cek History")
        print("3. Keluar")
        
        pilihan = input("Pilih menu (1/2/3): ")
        
        if pilihan == '1':
            input_data()
        elif pilihan == '2':
            cek_history()
        elif pilihan == '3':
            print("Terima kasih telah menggunakan program ini!")
            break
        else:
            print("❌ Pilihan tidak valid. Silakan pilih 1, 2, atau 3.")

if __name__ == "__main__":
    main()
